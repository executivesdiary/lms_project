
{% extends 'lead_management/base_dashboard.html' %}
{% load static %}

{% block title %}Editor Insights{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4">ðŸ“Š Editor Performance Insights</h2>

    {% if insights %}
        <canvas id="editorChart" height="120"></canvas>

        <table class="table table-striped table-hover table-bordered mt-5">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Total Drafts</th>
                    <th>Finalized</th>
                    <th>Fine-Tune Ready</th>
                    <th>Avg Tokens Used</th>
                </tr>
            </thead>
            <tbody>
                {% for editor in insights %}
                <tr>
                    <td>{{ editor.editor.get_full_name }}</td>
                    <td>{{ editor.editor.email }}</td>
                    <td>{{ editor.total_drafts }}</td>
                    <td>{{ editor.final_count }}</td>
                    <td>{{ editor.fine_tune_count }}</td>
                    <td>{{ editor.avg_tokens }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">No editor data available.</div>
    {% endif %}
</div>

{% if chart_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('editorChart').getContext('2d');
    const editorChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ chart_data.labels|safe }},
            datasets: [
                {
                    label: 'Total Drafts',
                    data: {{ chart_data.total_drafts|safe }},
                    backgroundColor: 'rgba(54, 162, 235, 0.6)'
                },
                {
                    label: 'Finalized',
                    data: {{ chart_data.final_count|safe }},
                    backgroundColor: 'rgba(75, 192, 192, 0.6)'
                },
                {
                    label: 'Fine-Tune Ready',
                    data: {{ chart_data.fine_tune_count|safe }},
                    backgroundColor: 'rgba(255, 206, 86, 0.6)'
                },
                {
                    label: 'Avg Tokens Used',
                    data: {{ chart_data.avg_tokens|safe }},
                    backgroundColor: 'rgba(153, 102, 255, 0.6)'
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Editor Performance Overview'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Count / Tokens'
                    }
                }
            }
        }
    });
</script>
{% endif %}
{% endblock %}
